<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Analyzing Social Hierarchy Data | Curley Lab Code Tutorials</title>
  <meta name="description" content="Chapter 2 Analyzing Social Hierarchy Data | Curley Lab Code Tutorials" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Analyzing Social Hierarchy Data | Curley Lab Code Tutorials" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Analyzing Social Hierarchy Data | Curley Lab Code Tutorials" />
  
  
  

<meta name="author" content="James Curley" />


<meta name="date" content="2021-09-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="plotting-sociomatrices-1.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Code Tutorials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html"><i class="fa fa-check"></i><b>2</b> Analyzing Social Hierarchy Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#raw-data"><i class="fa fa-check"></i><b>2.2</b> Raw Data</a></li>
<li class="chapter" data-level="2.3" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#data-cleanup"><i class="fa fa-check"></i><b>2.3</b> Data Cleanup</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#time-formats"><i class="fa fa-check"></i><b>2.3.1</b> Time Formats</a></li>
<li class="chapter" data-level="2.3.2" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#actorrecipients"><i class="fa fa-check"></i><b>2.3.2</b> Actor/Recipients</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#data-analysis"><i class="fa fa-check"></i><b>2.4</b> Data Analysis</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#create-sociomatrices"><i class="fa fa-check"></i><b>2.4.1</b> Create Sociomatrices</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#basic-hierarchy-measures"><i class="fa fa-check"></i><b>2.5</b> Basic hierarchy Measures</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#descriptives"><i class="fa fa-check"></i><b>2.5.1</b> Descriptives</a></li>
<li class="chapter" data-level="2.5.2" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#directional-consistency"><i class="fa fa-check"></i><b>2.5.2</b> Directional Consistency</a></li>
<li class="chapter" data-level="2.5.3" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#de-vries-modified-h-value"><i class="fa fa-check"></i><b>2.5.3</b> De Vries’ Modified h’ value</a></li>
<li class="chapter" data-level="2.5.4" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#triangle-transitivity"><i class="fa fa-check"></i><b>2.5.4</b> Triangle Transitivity</a></li>
<li class="chapter" data-level="2.5.5" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#steepness"><i class="fa fa-check"></i><b>2.5.5</b> Steepness</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#individual-ranking-measures"><i class="fa fa-check"></i><b>2.6</b> Individual Ranking Measures</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#davids-scores"><i class="fa fa-check"></i><b>2.6.1</b> David’s Scores</a></li>
<li class="chapter" data-level="2.6.2" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#isi-method"><i class="fa fa-check"></i><b>2.6.2</b> I&amp;SI Method</a></li>
<li class="chapter" data-level="2.6.3" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#despotism"><i class="fa fa-check"></i><b>2.6.3</b> Despotism</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#plotting-sociomatrices"><i class="fa fa-check"></i><b>2.7</b> Plotting Sociomatrices</a></li>
<li class="chapter" data-level="2.8" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#network-certainty"><i class="fa fa-check"></i><b>2.8</b> Network Certainty</a></li>
<li class="chapter" data-level="2.9" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#temporal-based-methods"><i class="fa fa-check"></i><b>2.9</b> Temporal Based Methods</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#glicko-ratings"><i class="fa fa-check"></i><b>2.9.1</b> Glicko Ratings</a></li>
<li class="chapter" data-level="2.9.2" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#stability-indices"><i class="fa fa-check"></i><b>2.9.2</b> Stability Indices</a></li>
<li class="chapter" data-level="2.9.3" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#temporal-social-dynamics"><i class="fa fa-check"></i><b>2.9.3</b> Temporal Social Dynamics</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="analyzing-social-hierarchy-data.html"><a href="analyzing-social-hierarchy-data.html#summary"><i class="fa fa-check"></i><b>2.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="plotting-sociomatrices-1.html"><a href="plotting-sociomatrices-1.html"><i class="fa fa-check"></i><b>3</b> Plotting Sociomatrices</a>
<ul>
<li class="chapter" data-level="3.1" data-path="plotting-sociomatrices-1.html"><a href="plotting-sociomatrices-1.html#raw-sociomatrices"><i class="fa fa-check"></i><b>3.1</b> Raw Sociomatrices</a></li>
<li class="chapter" data-level="3.2" data-path="plotting-sociomatrices-1.html"><a href="plotting-sociomatrices-1.html#dichotomized-sociomatrices"><i class="fa fa-check"></i><b>3.2</b> Dichotomized Sociomatrices</a></li>
<li class="chapter" data-level="3.3" data-path="plotting-sociomatrices-1.html"><a href="plotting-sociomatrices-1.html#multiple-sociomatrices"><i class="fa fa-check"></i><b>3.3</b> Multiple Sociomatrices</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="social-networks.html"><a href="social-networks.html"><i class="fa fa-check"></i><b>4</b> Social Networks</a>
<ul>
<li class="chapter" data-level="4.1" data-path="social-networks.html"><a href="social-networks.html#permutation-methods"><i class="fa fa-check"></i><b>4.1</b> Permutation Methods</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="social-networks.html"><a href="social-networks.html#node-permutation-example"><i class="fa fa-check"></i><b>4.1.1</b> Node Permutation Example</a></li>
<li class="chapter" data-level="4.1.2" data-path="social-networks.html"><a href="social-networks.html#random-graph-approach"><i class="fa fa-check"></i><b>4.1.2</b> Random Graph Approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mixed-effect-models.html"><a href="mixed-effect-models.html"><i class="fa fa-check"></i><b>5</b> Mixed-Effect Models</a></li>
<li class="chapter" data-level="6" data-path="musicnotationr.html"><a href="musicnotationr.html"><i class="fa fa-check"></i><b>6</b> musicnotationR</a>
<ul>
<li class="chapter" data-level="6.1" data-path="musicnotationr.html"><a href="musicnotationr.html#installation"><i class="fa fa-check"></i><b>6.1</b> Installation</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="musicnotationr.html"><a href="musicnotationr.html#sample-data-sets"><i class="fa fa-check"></i><b>6.1.1</b> Sample Data Sets</a></li>
<li class="chapter" data-level="6.1.2" data-path="musicnotationr.html"><a href="musicnotationr.html#plotting-music-notation-social-graphs"><i class="fa fa-check"></i><b>6.1.2</b> Plotting Music Notation Social Graphs</a></li>
<li class="chapter" data-level="6.1.3" data-path="musicnotationr.html"><a href="musicnotationr.html#further-customization-of-music-notation-plots"><i class="fa fa-check"></i><b>6.1.3</b> Further customization of music notation plots</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Curley Lab Code Tutorials</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analyzing-social-hierarchy-data" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Analyzing Social Hierarchy Data</h1>
<p><br></p>
<div id="overview" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Overview</h2>
<p>This is a brief introduction into how my lab analyzes social hierarchy data. It is primarily for my students to use as a guide, but much of it is probably useful for anybody that has any type of win-loss data.</p>
<p>We will use an example raw data file from our lab and various R packages to analyze the data. We will heavily use my <a href="https://github.com/jalapic/compete">compete R package</a> for analyzing competitive social interactions. The package contains some functions for transitioning data from edgelists of winner-losers to raw frequency win-lose sociomatrices to binary sociomatrices. The package also contains several functions for calculating particular hierarchy metrics. Additional R packages for calculating other metrics that we will use are detailed below. We will also source some code I’ve stored on GitHub (<a href="https://gist.githubusercontent.com/jalapic/6ca3ece44bdcdc522bb735f183aa0ca0/raw/1a07f469eff08117121b6cbebcd22fb7569e3ee8/compete_extra.R">compete_extra.R</a>) that contains several functions used here.</p>
<p><br></p>
</div>
<div id="raw-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Raw Data</h2>
<p>We collect data on which animals win and lose during dyadic agonistic interactions that occur continuously within a social group. Typically we study groups of 12 individuals - each individual being randomly assigned the numbers 1-12 to identify them. Wins and losses (and ties) are collected in real time by observers who upload to a Google Survey data sheet. One option for retrieving the raw data would be to automatically download the data from Google Survey itself using an R package like <a href="https://googlesheets4.tidyverse.org/">googlesheets4</a>. However, for now the simplest method is to download the raw data file from Google and store it somewhere. I have done this for an example file and stored it on GitHub.</p>
<p>Note to students: make sure you download the file as a csv file not an xls file. The timestamp column should have seconds in it - if you save as an xls file it may get rid of the seconds and they will all appear as 00.</p>
<p>For this introduction, we will use the <a href="https://gist.github.com/jalapic/97d05d598e9d4d96be5686e87b5bd452">data stored here</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="analyzing-social-hierarchy-data.html#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://gist.githubusercontent.com/jalapic/97d05d598e9d4d96be5686e87b5bd452/raw/fe60da1542527d159e105c5560f250886f54a2dc/mousedata.csv&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb1-2"><a href="analyzing-social-hierarchy-data.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div>
<pre><code>##             Timestamp Actor    Behavior Recipient Location Observer Notes
## 1 10/14/2014 11:57:16 Start       Start     Start    Start       CW  &lt;NA&gt;
## 2 10/14/2014 12:03:10     6    Mounting        10      NB4       CW  &lt;NA&gt;
## 3 10/14/2014 12:04:16     6    Fighting         5      NB5       CW  &lt;NA&gt;
## 4 10/14/2014 12:19:27     3    Fighting         4       ML       CW  &lt;NA&gt;
## 5 10/14/2014 12:28:05     4 Subordinate        10       LL       CW  &lt;NA&gt;
## 6 10/14/2014 12:30:49     4    Fighting         2      NB1       CW  &lt;NA&gt;</code></pre>
<p><br></p>
</div>
<div id="data-cleanup" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Data Cleanup</h2>
<p>The first thing to do with the raw data is to clean up mistakes made by observers and to check for other mistakes. These will generally be put in the notes column, but there are others to check for. The main issues are to do with animals being misidentified or observers forgetting to enter a start/end time or adding multiple start/end times.</p>
<p>Most notes in this example dataset are blank - but you can see those that are there by doing the following to remove <code>NA</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="analyzing-social-hierarchy-data.html#cb3-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Notes[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>Notes)]</span></code></pre></div>
<pre><code>##  [1] &quot;long fight, it wasn&#39;t clear who started it, neither gave in&quot;                                 
##  [2] &quot;chased from mid left to upper left, some biting of the tsail&quot;                                
##  [3] &quot;chase from UR to UL&quot;                                                                         
##  [4] &quot;UR =&gt; UL&quot;                                                                                    
##  [5] &quot;unrelated to previous fight -- abt a min later&quot;                                              
##  [6] &quot;UL =&gt; UR&quot;                                                                                    
##  [7] &quot;late bc extractim&quot;                                                                           
##  [8] &quot;**last note was supposed to say late bc extracting rna with rahia&quot;                           
##  [9] &quot;another incidence, not a double record&quot;                                                      
## [10] &quot;another incidence, not a double record&quot;                                                      
## [11] &quot;in general, the mice were much less active during the second hour&quot;                           
## [12] &quot;in general, the mice were much less active during the second hour&quot;                           
## [13] &quot;happened in the tube between lower left and nest box 2&quot;                                      
## [14] &quot;***weird bc 3 is notma&quot;                                                                      
## [15] &quot;comment a few back was supposed to say weird bc 3 is normally dominant, but im sure it was 3&quot;
## [16] &quot;contextual aggression?&quot;                                                                      
## [17] &quot;ul down to nb5&quot;                                                                              
## [18] &quot;at the same time as 6 chased 10&quot;                                                             
## [19] &quot;couldn&#39;t tell who won&quot;                                                                       
## [20] &quot;6 attacked first then 4 wins the fight&quot;                                                      
## [21] &quot;prolonged intense fight tied, though 6 fleed at last&quot;                                        
## [22] &quot;prolonged intense fight tied, though 6 fleed at last&quot;                                        
## [23] &quot;internet disruption at 12 45pm&quot;                                                              
## [24] &quot;8 has distinguished size of testes&quot;</code></pre>
<p>The only comment here that needs double checking is the one where the observer couldn’t determine who won. That contest should be scored as a tie. We can check by finding the row number and searching for it.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="analyzing-social-hierarchy-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(df<span class="sc">$</span>Notes<span class="sc">==</span><span class="st">&quot;couldn&#39;t tell who won&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 951</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="analyzing-social-hierarchy-data.html#cb7-1" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">951</span>,]</span></code></pre></div>
<pre><code>##              Timestamp Actor Behavior Recipient Location Observer                 Notes
## 951 11/3/2014 15:44:34  2, 9 Fighting      2, 9      NB5       BN couldn&#39;t tell who won</code></pre>
<p>As can be seen, it’s a tie between 2 &amp; 9.</p>
<p><br></p>
<div id="time-formats" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Time Formats</h3>
<p>Next, it’s useful to add a day column and a time column. The following assumes:</p>
<ul>
<li>that the first day of observations was the first day of housing (it almost always is).</li>
<li>that there were no changes in daylight savings or light cycle</li>
<li>that the google survey was set up in EST.</li>
<li>that the observations all took place within the same calendar year.</li>
</ul>
<p>If any of the above are not true, the following code needs to be adjusted. If they are all true we’ll first convert the Google Survey timestamp to R’s Date-Time format and extract the day and time.</p>
<p>We use the <code>lubridate</code> package to extract hours and days. We also make sure the Date-Time format we use is <code>POSIXct</code> as <code>POSIXlt</code> uses too much memory. The first day of observations is day 1. The first hour of observation each day is at 12pm when the lights change from white to red (the animals become more active in red light/dark phase).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="analyzing-social-hierarchy-data.html#cb9-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Timestamp <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="fu">strptime</span>(df<span class="sc">$</span>Timestamp,<span class="st">&#39;%m/%d/%Y %H:%M:%S&#39;</span>))</span>
<span id="cb9-2"><a href="analyzing-social-hierarchy-data.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="analyzing-social-hierarchy-data.html#cb9-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>day <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">yday</span>(df<span class="sc">$</span>Timestamp) <span class="sc">-</span> <span class="fu">min</span>(lubridate<span class="sc">::</span><span class="fu">yday</span>(df<span class="sc">$</span>Timestamp)) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-4"><a href="analyzing-social-hierarchy-data.html#cb9-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>zhour <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(df<span class="sc">$</span>Timestamp)<span class="sc">-</span><span class="dv">11</span></span>
<span id="cb9-5"><a href="analyzing-social-hierarchy-data.html#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="analyzing-social-hierarchy-data.html#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="analyzing-social-hierarchy-data.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div>
<pre><code>##             Timestamp Actor    Behavior Recipient Location Observer Notes day zhour
## 1 2014-10-14 11:57:16 Start       Start     Start    Start       CW  &lt;NA&gt;   1     0
## 2 2014-10-14 12:03:10     6    Mounting        10      NB4       CW  &lt;NA&gt;   1     1
## 3 2014-10-14 12:04:16     6    Fighting         5      NB5       CW  &lt;NA&gt;   1     1
## 4 2014-10-14 12:19:27     3    Fighting         4       ML       CW  &lt;NA&gt;   1     1
## 5 2014-10-14 12:28:05     4 Subordinate        10       LL       CW  &lt;NA&gt;   1     1
## 6 2014-10-14 12:30:49     4    Fighting         2      NB1       CW  &lt;NA&gt;   1     1</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="analyzing-social-hierarchy-data.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(df)</span></code></pre></div>
<pre><code>##                Timestamp Actor          Behavior Recipient Location Observer Notes day zhour
## 1054 2014-11-04 13:51:49     4 Fighting, Chasing         6       LL       WL  &lt;NA&gt;  22     2
## 1055 2014-11-04 13:52:49     4           Chasing         6       UL       WL  &lt;NA&gt;  22     2
## 1056 2014-11-04 13:53:42     4           Chasing        10       UL       WL  &lt;NA&gt;  22     2
## 1057 2014-11-04 13:55:10     6           Chasing        12       LL       WL  &lt;NA&gt;  22     2
## 1058 2014-11-04 13:56:48     4           Chasing        10       UL       WL  &lt;NA&gt;  22     2
## 1059 2014-11-04 14:00:48   End               End       End      End       WL  &lt;NA&gt;  22     3</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="analyzing-social-hierarchy-data.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>day)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 21 22</code></pre>
<p>Notice that there are no observations for day=20 - this will be relevant later on when we plot data by day.</p>
<p><br></p>
</div>
<div id="actorrecipients" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Actor/Recipients</h3>
<p>Next we will look at the Actor and Recipient variables.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="analyzing-social-hierarchy-data.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>Actor)</span></code></pre></div>
<pre><code>##  [1] &quot;Start&quot;  &quot;6&quot;      &quot;3&quot;      &quot;4&quot;      &quot;5&quot;      &quot;1&quot;      &quot;9&quot;      &quot;2, 4&quot;   &quot;End&quot;    &quot;12&quot;    
## [11] &quot;2&quot;      &quot;7&quot;      &quot;11&quot;     &quot;1, 2&quot;   &quot;10, 11&quot; &quot;8&quot;      &quot;10&quot;     &quot;2, 9&quot;   &quot;2, 11&quot;  &quot;7, 11&quot; 
## [21] &quot;4, 6&quot;   &quot;3, 6&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="analyzing-social-hierarchy-data.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(df<span class="sc">$</span>Recipient)</span></code></pre></div>
<pre><code>##  [1] &quot;Start&quot;    &quot;10&quot;       &quot;5&quot;        &quot;4&quot;        &quot;2&quot;        &quot;1&quot;        &quot;11&quot;       &quot;8&quot;       
##  [9] &quot;2, 4&quot;     &quot;7&quot;        &quot;3&quot;        &quot;6&quot;        &quot;End&quot;      &quot;9&quot;        &quot;7, 10&quot;    &quot;1, 2&quot;    
## [17] &quot;10, 11&quot;   &quot;12&quot;       &quot;1, 9&quot;     &quot;7, 8&quot;     &quot;7, 12&quot;    &quot;2, 6&quot;     &quot;8, 10&quot;    &quot;3, 7&quot;    
## [25] &quot;11, 12&quot;   &quot;2, 9&quot;     &quot;2, 7&quot;     &quot;2, 8, 10&quot; &quot;1, 7, 12&quot; &quot;3, 6&quot;     &quot;6, 8&quot;     &quot;2, 11&quot;</code></pre>
<p>First of all, we can remove the ‘Start’ and ‘End’ rows. These indicate when an observer starts and finishes their set observation. We need these when counting rates of behavior per hour, but we won’t do that in this example.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="analyzing-social-hierarchy-data.html#cb19-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>Actor<span class="sc">!=</span><span class="st">&quot;Start&quot;</span>,]</span>
<span id="cb19-2"><a href="analyzing-social-hierarchy-data.html#cb19-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>Actor<span class="sc">!=</span><span class="st">&quot;End&quot;</span>,]</span></code></pre></div>
<p>The next thing to deal with is that some rows have multiple values in the ‘Actor’ or ‘Recipient’ columns. This can be either:</p>
<p>two individuals tie during a contest (then both Actor and Recipient will have same two animals in the entry) one Actor beats more than one Recipient simultaneously one Recipient is beaten by more than one Actor simultaneously (much less common)
To simplify this process, I have stored a function - <code>expandrows</code> on GitHub that we can source. With time, I’ll add this function to my CurleyLab R package to make it easily available. To use it, you must have <code>splitstackshape</code> and <code>data.table</code> installed. The former is a great package for easy management of google survey type data. This function also adds a column ‘score’ with a 1 indicating a clear win for the Actor vs the Recipient, and a 0.5 indicating a tie.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="analyzing-social-hierarchy-data.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;https://gist.githubusercontent.com/jalapic/6ca3ece44bdcdc522bb735f183aa0ca0/raw/1a07f469eff08117121b6cbebcd22fb7569e3ee8/compete_extra.R&quot;</span>)</span>
<span id="cb20-2"><a href="analyzing-social-hierarchy-data.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="analyzing-social-hierarchy-data.html#cb20-3" aria-hidden="true" tabindex="-1"></a>df1<span class="ot">&lt;-</span><span class="fu">expandrows</span>(df)</span>
<span id="cb20-4"><a href="analyzing-social-hierarchy-data.html#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="analyzing-social-hierarchy-data.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df1)</span></code></pre></div>
<pre><code>##              Timestamp Actor    Behavior Recipient Location Observer Notes day zhour score
## 1: 2014-10-14 12:03:10     6    Mounting        10      NB4       CW  &lt;NA&gt;   1     1     1
## 2: 2014-10-14 12:04:16     6    Fighting         5      NB5       CW  &lt;NA&gt;   1     1     1
## 3: 2014-10-14 12:19:27     3    Fighting         4       ML       CW  &lt;NA&gt;   1     1     1
## 4: 2014-10-14 12:28:05     4 Subordinate        10       LL       CW  &lt;NA&gt;   1     1     1
## 5: 2014-10-14 12:30:49     4    Fighting         2      NB1       CW  &lt;NA&gt;   1     1     1
## 6: 2014-10-14 12:34:39     4    Fighting         2      NB5       CW  &lt;NA&gt;   1     1     1</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="analyzing-social-hierarchy-data.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df1)</span></code></pre></div>
<pre><code>## [1] 1031</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="analyzing-social-hierarchy-data.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df1<span class="sc">$</span>Actor)</span></code></pre></div>
<pre><code>## 
##   1   2   3   4   5   6   7   8   9  10  11  12 
##  20  10 136 480   7 136 150  20   5   3  51  13</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="analyzing-social-hierarchy-data.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df1<span class="sc">$</span>Recipient)</span></code></pre></div>
<pre><code>## 
##   1   2   3   4   5   6   7   8   9  10  11  12 
##  66  94 111   9  37 119 131 121  93  96  89  65</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="analyzing-social-hierarchy-data.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df1<span class="sc">$</span>score)</span></code></pre></div>
<pre><code>## 
##  0.5    1 
##    6 1025</code></pre>
<p>In total we have 1031 agonistic interactions of which only 6 are ties.</p>
<p>Having got our data cleaned up, we can quickly look at a preliminary raw sociomatrix:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="analyzing-social-hierarchy-data.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> Actor <span class="sc">+</span> Recipient, df1)</span></code></pre></div>
<pre><code>##      Recipient
## Actor  1  2  3  4  5  6  7  8  9 10 11 12
##    1   0  4  1  1  2  3  0  2  6  0  0  1
##    2   0  0  1  1  0  0  2  2  2  0  2  0
##    3   9 16  0  2  8 23 45 13  6  9  0  5
##    4  21 40 79  0 16 53 76 43 38 28 64 22
##    5   2  0  0  1  0  3  0  0  1  0  0  0
##    6  11 13  9  2  3  0  4 39  8 22  4 21
##    7   5 16  1  0  4 33  0 17 22 32 11  9
##    8   4  1 11  0  0  0  1  0  1  0  2  0
##    9   0  0  0  1  0  0  0  0  0  0  3  1
##    10  1  0  0  0  0  0  0  0  0  0  1  1
##    11 13  3  8  0  1  3  2  2  9  5  0  5
##    12  0  1  1  1  3  1  1  3  0  0  2  0</code></pre>
<p><br></p>
</div>
</div>
<div id="data-analysis" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Data Analysis</h2>
<p>Once our data is in this clean format we can proceed with the basic data analysis. First of all we will consider all behaviors together - i.e. we won’t subset or weight by fighting, chasing, mounting or subordinate behaviors. We may want to do this for more fine-grained analysis, but not for this example. Also, we will consider all data collected over all days together to start with.</p>
<p>We will use the <code>compete</code> package to create sociomatrices and calculate several metrics.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="analyzing-social-hierarchy-data.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github(&#39;jalapic/compete&#39;)</span></span>
<span id="cb32-2"><a href="analyzing-social-hierarchy-data.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(compete)</span></code></pre></div>
<p><br></p>
<div id="create-sociomatrices" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Create Sociomatrices</h3>
<p>First we only need the winner and loser variables. Also, in this basic analysis, we will exclude ties. We could consider ties to be a 0.5 win, but given their low prevalence, it does not affect our results to exclude here. (Note the <code>get_wl_matrix</code> and <code>get_di_matrix</code> functions in compete can also automatically remove ties).</p>
<p>Also, because df1 is actually a <code>data.table</code> (produced by the <code>expandrows</code> function), we need to use data.table style indexing.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="analyzing-social-hierarchy-data.html#cb33-1" aria-hidden="true" tabindex="-1"></a>wldf <span class="ot">&lt;-</span> df1[score<span class="sc">==</span><span class="dv">1</span>][, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>), with <span class="ot">=</span> <span class="cn">FALSE</span>] </span>
<span id="cb33-2"><a href="analyzing-social-hierarchy-data.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#data.table indexing</span></span>
<span id="cb33-3"><a href="analyzing-social-hierarchy-data.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="analyzing-social-hierarchy-data.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wldf)</span></code></pre></div>
<pre><code>##    Actor Recipient
## 1:     6        10
## 2:     6         5
## 3:     3         4
## 4:     4        10
## 5:     4         2
## 6:     4         2</code></pre>
<p>The <code>get_wl_matrix</code> creates a raw frequency sociomatrix of wins and losses. This is similar to the table above. Here, e.g. animal 6 ‘won’ 13 times against animal 2, and animal 7 had 17 wins against animal 8.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="analyzing-social-hierarchy-data.html#cb35-1" aria-hidden="true" tabindex="-1"></a>wlmat <span class="ot">&lt;-</span> <span class="fu">get_wl_matrix</span>(wldf)</span>
<span id="cb35-2"><a href="analyzing-social-hierarchy-data.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="analyzing-social-hierarchy-data.html#cb35-3" aria-hidden="true" tabindex="-1"></a>wlmat</span></code></pre></div>
<pre><code>##      Recipient
## Actor  1 10 11 12  2  3  4  5  6  7  8  9
##    1   0  0  0  1  3  1  1  2  3  0  2  6
##    10  1  0  0  1  0  0  0  0  0  0  0  0
##    11 13  5  0  5  3  8  0  1  3  2  2  9
##    12  0  0  2  0  1  1  1  3  1  1  3  0
##    2   0  0  2  0  0  1  0  0  0  2  2  1
##    3   9  9  0  5 16  0  2  8 21 45 13  6
##    4  21 28 64 22 40 79  0 16 53 76 43 38
##    5   2  0  0  0  0  0  1  0  3  0  0  1
##    6  11 22  4 21 13  9  2  3  0  4 39  8
##    7   5 32 11  9 16  1  0  4 33  0 17 22
##    8   4  0  2  0  1 11  0  0  0  1  0  1
##    9   0  0  3  1  0  0  1  0  0  0  0  0</code></pre>
<p>For quick visualization purposes, we can use the <code>org_matrix</code> function. There are three methods of displaying the table - by alphanumeric name (<code>alpha</code>), by total wins (<code>wins</code>) or by David’s Scores (a measure of relative dominance).</p>
<p>Using the David’s Scores Methods, it looks a lot clearer that this social group has a hierarchical structure.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="analyzing-social-hierarchy-data.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">org_matrix</span>(wlmat, <span class="at">method=</span><span class="st">&quot;ds&quot;</span>)</span></code></pre></div>
<pre><code>##      Recipient
## Actor  4  7  3  6 11 10  5  8  1 12  2  9
##    4   0 76 79 53 64 28 16 43 21 22 40 38
##    7   0  0  1 33 11 32  4 17  5  9 16 22
##    3   2 45  0 21  0  9  8 13  9  5 16  6
##    6   2  4  9  0  4 22  3 39 11 21 13  8
##    11  0  2  8  3  0  5  1  2 13  5  3  9
##    10  0  0  0  0  0  0  0  0  1  1  0  0
##    5   1  0  0  3  0  0  0  0  2  0  0  1
##    8   0  1 11  0  2  0  0  0  4  0  1  1
##    1   1  0  1  3  0  0  2  2  0  1  3  6
##    12  1  1  1  1  2  0  3  3  0  0  1  0
##    2   0  2  1  0  2  0  0  2  0  0  0  1
##    9   1  0  0  0  3  0  0  0  0  1  0  0</code></pre>
<p>Another useful matrix to keep is the binarized win-loss matrix. This can be done using the <code>get_di_matrix</code> function. There are many ways in which a raw frequency sociomatrix could be converted to a binary matrix involving how to deal with ties, how to deal with structural zeros (unknown relationships where no observations were made between two individuals), and what criteria to use to choose a ‘clear’ winner. Here, we will use the simplest measure of assigning a 1 to individuals who win more frequently than the opposing individual and a 0 to losers or if there are ties (e.g. if both animals had 1 win against each other).</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="analyzing-social-hierarchy-data.html#cb39-1" aria-hidden="true" tabindex="-1"></a>bimat <span class="ot">&lt;-</span> <span class="fu">get_di_matrix</span>(wlmat)</span>
<span id="cb39-2"><a href="analyzing-social-hierarchy-data.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">org_matrix</span>(bimat, <span class="at">method=</span><span class="st">&quot;ds&quot;</span>)</span></code></pre></div>
<pre><code>##      Recipient
## Actor 4 3 7 6 11 10 5 1 8 2 12 9
##    4  0 1 1 1  1  1 1 1 1 1  1 1
##    3  0 0 1 1  0  1 1 1 1 1  1 1
##    7  0 0 0 1  1  1 1 1 1 1  1 1
##    6  0 0 0 0  1  1 0 1 1 1  1 1
##    11 0 1 0 0  0  1 1 1 0 1  1 1
##    10 0 0 0 0  0  0 0 1 0 0  1 0
##    5  0 0 0 0  0  0 0 0 0 0  0 1
##    1  0 0 0 0  0  0 0 0 0 1  1 1
##    8  0 0 0 0  0  0 0 1 0 0  0 1
##    2  0 0 0 0  0  0 0 0 1 0  0 1
##    12 0 0 0 0  0  0 1 0 1 1  0 0
##    9  0 0 0 0  0  0 0 0 0 0  1 0</code></pre>
<p><br></p>
</div>
</div>
<div id="basic-hierarchy-measures" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Basic hierarchy Measures</h2>
<div id="descriptives" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Descriptives</h3>
<p>From the above matrices we can calculate a number of descriptive statistics.</p>
<p>The <code>rshps</code> function gives us the total relationships in the group, the total number of unknown relationships (i.e. each animal recorded 0 wins against each other), the number of relationships that are tied (i.e. no clear winner), the number of twoways relationships (where both animals recorded at least one win) and the number of oneways relationships (where only one animal recorded a win).</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="analyzing-social-hierarchy-data.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rshps</span>(wlmat)</span></code></pre></div>
<pre><code>## $total
## [1] 66
## 
## $unknowns
## [1] 6
## 
## $ties
## [1] 3
## 
## $twoways
## [1] 25
## 
## $oneways
## [1] 32</code></pre>
<p><br></p>
</div>
<div id="directional-consistency" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Directional Consistency</h3>
<p>The Directional Consistency of the sociomatrix - 0 meaning no directional consistency and 1 indicating that all contests are won by more dominant individuals over more subordinate individuals. The skew-symmetry index determines if there is asymmetry in interactions in a sociomatrix. 0 indicates complete reciprocity whereas 0.5 indicates complete unidirectionality.</p>
<p>The <code>dc_test</code> function will run the statistical tests suggested by <a href="https://reunido.uniovi.es/index.php/Rema/article/view/9788">Leiva et al. 2009</a> to ascertain if the directional consistency and phi values are significant or not.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="analyzing-social-hierarchy-data.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dc_test</span>(wlmat)</span></code></pre></div>
<pre><code>## $DC.pvalue
## [1] 1e-04
## 
## $phi.pvalue
## [1] 1e-04
## 
## $mean_phi
## [1] 0.02527277
## 
## $mean_DC
## [1] 0.1285362
## 
## $variance_phi
##              [,1]
## [1,] 2.567624e-05
## 
## $variance_DC
##              [,1]
## [1,] 0.0002070462
## 
## $DC
## [1] 0.8712195
## 
## $phi
## [1] 0.4689508</code></pre>
<p>For quick access to the DC and phi values, the following functions can be run:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="analyzing-social-hierarchy-data.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dci</span>(wlmat)</span></code></pre></div>
<pre><code>## [1] 0.8712195</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="analyzing-social-hierarchy-data.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">phi</span>(wlmat)</span></code></pre></div>
<pre><code>## [1] 0.4689508</code></pre>
<p><br></p>
</div>
<div id="de-vries-modified-h-value" class="section level3" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> De Vries’ Modified h’ value</h3>
<p>The most common measure of social hierarchy linearity is the modified h’ value by <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.507.3738&amp;rep=rep1&amp;type=pdf">De Vries 1995</a>. The <code>devries</code> function will provide the h’ value of a sociomatrix and associated p-value from a randomization test.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="analyzing-social-hierarchy-data.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">devries</span>(wlmat)</span></code></pre></div>
<pre><code>## $`h-modified`
## [1] 0.7586371
## 
## $`p-value`
## [1] 0</code></pre>
<p>It’s also possible to plot the results of the randomization test:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="analyzing-social-hierarchy-data.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">devries</span>(wlmat, <span class="at">plot=</span>T)</span></code></pre></div>
<pre><code>## h-modified = 0.7587636 
##  p-value= 0</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="triangle-transitivity" class="section level3" number="2.5.4">
<h3><span class="header-section-number">2.5.4</span> Triangle Transitivity</h3>
<p>The third measure of hierarchical organization is the triangle transitivity suggested by <a href="doi:10.1016/j.anbehav.2012.01.011">Shizuka &amp; McDonald 2012</a>. This measure calculate the proportion of transitive versus intransitive triads within the directed network. The index ranges between 0 and 1, with 1 indicating that all triads are transitive (i.e. there are no cycles). This function also provides output from a randomization test to assess if the proportion of transitive triads is higher than expected (i.e. there is hierarchical organization).</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="analyzing-social-hierarchy-data.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ttri_test</span>(wlmat)</span></code></pre></div>
<pre><code>## $Pt
## [1] 0.9527027
## 
## $ttri
## [1] 0.8108108
## 
## $pval
## [1] 0</code></pre>
<p>This value can be ascertained quickly using <code>ttri</code>:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="analyzing-social-hierarchy-data.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ttri</span>(wlmat)</span></code></pre></div>
<pre><code>## $Pt
## [1] 0.9527027
## 
## $ttri
## [1] 0.8108108</code></pre>
<p>There are of course several other network measures that could be used to describe the hierarchical organiation of a social hierarchy, but I won’t cover those here.</p>
<p><br></p>
</div>
<div id="steepness" class="section level3" number="2.5.5">
<h3><span class="header-section-number">2.5.5</span> Steepness</h3>
<p>Another measure of hierarchies are how steep the individual differences in David’s Scores are - prosposed by <a href="http://www.sciencedirect.com/science/article/pii/S0003347206000066">De Vries et al 2006</a>. The higher the steepness, the greater the differences between individual ranks in their ratings. The scores range between 0 and 1, with 1 having the greatest differences between ranks in scores. We can test this using the <code>steepness</code> package.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="analyzing-social-hierarchy-data.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(steepness)</span>
<span id="cb57-2"><a href="analyzing-social-hierarchy-data.html#cb57-2" aria-hidden="true" tabindex="-1"></a>steep <span class="ot">&lt;-</span> steepness<span class="sc">::</span><span class="fu">steeptest</span>(wlmat, <span class="at">rep=</span><span class="dv">10000</span>)</span>
<span id="cb57-3"><a href="analyzing-social-hierarchy-data.html#cb57-3" aria-hidden="true" tabindex="-1"></a>steep<span class="sc">$</span>Stp <span class="co">#Steepness</span></span></code></pre></div>
<pre><code>## [1] 0.5598867</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="analyzing-social-hierarchy-data.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>( (steep<span class="sc">$</span>Stpsim <span class="sc">&gt;</span> steep<span class="sc">$</span>Stp) <span class="sc">/</span> <span class="dv">10000</span> )  <span class="co">#pvalue</span></span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p><br></p>
</div>
</div>
<div id="individual-ranking-measures" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Individual Ranking Measures</h2>
<p>A proliferation of ranking methods exist to try and determine which individual is more ‘dominant’, ‘powerful’ or ‘influential’ in a group. Many of the more recent methods are network based (I will cover these in a future tutorial/primer), others come from the sports data literature. Here I will describe some standard methods used in animal behavior.</p>
<p><br></p>
<div id="davids-scores" class="section level3" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> David’s Scores</h3>
<p>A simple measure is the David’s Scores of each individual. This can be considered to be the opponent-adjusted win proportion of each individual. Individuals with positive David’s Scores are more dominant. Individuals with negative David’s Scores are losing more fights.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="analyzing-social-hierarchy-data.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds</span>(wlmat)</span></code></pre></div>
<pre><code>##         1        10        11        12         2         3         4         5         6 
## -15.31674 -13.52634  11.59505 -18.63460 -21.89749  21.64528  55.85957 -14.45596  15.03441 
##         7         8         9 
##  26.89502 -15.08334 -32.11487</code></pre>
<p>Viewing this as a simple plot shows the steepness of David’s Scores:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="analyzing-social-hierarchy-data.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="fu">rev</span>(<span class="fu">sort</span>(<span class="fu">ds</span>(wlmat))), <span class="st">&quot;l&quot;</span>,</span>
<span id="cb63-2"><a href="analyzing-social-hierarchy-data.html#cb63-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Rank&quot;</span>,</span>
<span id="cb63-3"><a href="analyzing-social-hierarchy-data.html#cb63-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;David&#39;s Score&quot;</span>,</span>
<span id="cb63-4"><a href="analyzing-social-hierarchy-data.html#cb63-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;David&#39;s Scores by Rank&quot;</span>)</span>
<span id="cb63-5"><a href="analyzing-social-hierarchy-data.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="isi-method" class="section level3" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> I&amp;SI Method</h3>
<p>A commonly used method is the linear ordering algorithm - the I&amp;SI ranking method. This attempts to shuffle the binary sociomatix such that 1s are all above the diagonal and 0s are all below the diagonal. Further, it tries to get 1s under the diagonal as close to it as possible. This is computationally expensive - and I need to implement this in C++ in the next version of the <code>compete</code> package. There are two versions of this algorithm - <code>isi98</code> is the original method <a href="https://www.ncbi.nlm.nih.gov/pubmed/9632471">proposed here</a> and <code>isi13</code> is the updated method <a href="http://www.sciencedirect.com/science/article/pii/S0003347213004132">proposed here</a>. I recommend using the former as the updated version is too slow for most matrices - and the additional benefit in improved linear ordering isn’t huge. Also, it is worth running this procedure a few times to find the optimal ranking as it uses randomization to try and find the best matrix.</p>
<p>The output gives the initial matrix order, the proposed ‘best matrix’, the I (number of inconsistencies), the SI (the strength of inconsistencies), and the ‘best order’ of ranks. It also gives ‘rs’ the correlation between the ranks proposed by the I&amp;SI method and the David’s Scores. Running this example several times, it appears as if the best solution is I=3, SI=10 and rs=0.88.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="analyzing-social-hierarchy-data.html#cb64-1" aria-hidden="true" tabindex="-1"></a>isi.out <span class="ot">&lt;-</span>  <span class="fu">isi98</span>(wlmat)</span></code></pre></div>
<pre><code>## 
## INITIAL RANK: 
##  [1] &quot;4&quot;  &quot;7&quot;  &quot;3&quot;  &quot;6&quot;  &quot;11&quot; &quot;10&quot; &quot;5&quot;  &quot;8&quot;  &quot;1&quot;  &quot;12&quot; &quot;2&quot;  &quot;9&quot; 
## I = 6
## SI = 13</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="analyzing-social-hierarchy-data.html#cb66-1" aria-hidden="true" tabindex="-1"></a>isi.out</span></code></pre></div>
<pre><code>## $best_matrix
##      Recipient
## Actor  4  3  7  6 11 10  1 12  2  8  5  9
##    4   0 79 76 53 64 28 21 22 40 43 16 38
##    3   2  0 45 21  0  9  9  5 16 13  8  6
##    7   0  1  0 33 11 32  5  9 16 17  4 22
##    6   2  9  4  0  4 22 11 21 13 39  3  8
##    11  0  8  2  3  0  5 13  5  3  2  1  9
##    10  0  0  0  0  0  0  1  1  0  0  0  0
##    1   1  1  0  3  0  0  0  1  3  2  2  6
##    12  1  1  1  1  2  0  0  0  1  3  3  0
##    2   0  1  2  0  2  0  0  0  0  2  0  1
##    8   0 11  1  0  2  0  4  0  1  0  0  1
##    5   1  0  0  3  0  0  2  0  0  0  0  1
##    9   1  0  0  0  3  0  0  1  0  0  0  0
## 
## $best_order
##  [1] &quot;4&quot;  &quot;3&quot;  &quot;7&quot;  &quot;6&quot;  &quot;11&quot; &quot;10&quot; &quot;1&quot;  &quot;12&quot; &quot;2&quot;  &quot;8&quot;  &quot;5&quot;  &quot;9&quot; 
## 
## $I
## [1] 3
## 
## $SI
## [1] 10
## 
## $rs
## [1] 0.8811189</code></pre>
<p><br></p>
</div>
<div id="despotism" class="section level3" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> Despotism</h3>
<p>Another metric we can calculate is the proportion of wins made by each animal. The proportion of wins made by the alpha male is that individual’s ‘despotism’. I’ll implement this as a function in the <code>compete</code> package in the future - at present, it can be found in the sourced code from GitHub above.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="analyzing-social-hierarchy-data.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">despotism</span>(wlmat)</span></code></pre></div>
<pre><code>##     4     7     6     3    11     8     1    12     2     5     9    10 
## 46.83 14.63 13.27 13.07  4.98  1.95  1.85  1.27  0.78  0.68  0.49  0.20</code></pre>
<p><br></p>
</div>
</div>
<div id="plotting-sociomatrices" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Plotting Sociomatrices</h2>
<p>We can also use the observed best ranking order of our choice to make a customized raw sociomatrix that we could use in a publication. This is using a <code>ggplot2</code> based function I wrote called matrixplot. If you lookup the function, you can change the color scheme if you wish.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="analyzing-social-hierarchy-data.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrixplot</span>(wlmat, <span class="at">mylevs=</span>isi.out<span class="sc">$</span>best_order)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-35-1.png" width="576" /></p>
<p>There is also a plot to color the binarized matrix based on the directional consistency of each relationship. The redder a cell, the higher the proportion of wins by that individual. This method is useful for quickly visualizing the inconsistencies in the hierarchy.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="analyzing-social-hierarchy-data.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrixplot0</span>(wlmat, <span class="at">mylevs=</span>isi.out<span class="sc">$</span>best_order)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-36-1.png" width="576" /></p>
<p>Interestingly the relationship that has the most noticable inconsistency is id-11 vs id-3, where 11 beat 3 eight times but 3 never beat 11. This is despite 3 being higher ranked than 11. Often when examining all data over all days such inconsistencies may be the result of initial day 1 or day 2 interactions. This can be checked using the function <code>contests</code>.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="analyzing-social-hierarchy-data.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contests</span>(df1,<span class="dv">11</span>,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##              Timestamp Actor    Behavior Recipient Location Observer Notes day zhour score
## 1: 2014-10-16 12:42:13    11 Subordinate         3       UR       CW  &lt;NA&gt;   3     1     1
## 2: 2014-10-16 12:42:32    11     Chasing         3       UL       CW  &lt;NA&gt;   3     1     1
## 3: 2014-10-16 13:25:25    11     Chasing         3       UL       CW  &lt;NA&gt;   3     2     1
## 4: 2014-11-03 14:50:47    11     Chasing         3       UR       AP  &lt;NA&gt;  21     3     1
## 5: 2014-11-03 14:51:49    11     Chasing         3       UR       AP  &lt;NA&gt;  21     3     1
## 6: 2014-11-03 14:54:48    11     Chasing         3       UR       AP  &lt;NA&gt;  21     3     1
## 7: 2014-11-03 14:57:49    11     Chasing         3       UR       AP  &lt;NA&gt;  21     3     1
## 8: 2014-11-04 13:23:32    11 Induce-flee         3       UR       WL  &lt;NA&gt;  22     2     1</code></pre>
<p>Here there are three early interactions on day 3, but 11 continues to beat 3 on the last two days of observation. This was by three separate observers suggesting that it is reliable. Most interestingly though, none of the agonistic interactions were fights - all were chases or induced subordinate behaviors (in our ethogram ‘induced-flee’ means here that animal 11 caused 3 to flee and on row 1 that animal 11 caused animal 3 to show a subordinate posture.</p>
<p>Clearly, there are many other methods for assessing the individual rankings/ratings of a social group. There are several network based metrics, matrix based measures, preferred comparison methods etc. I may cover these in a future primer.</p>
</div>
<div id="network-certainty" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Network Certainty</h2>
<p>Another valuable approach is to measure the certainty we have of each individual’s ranking using <a href="https://peerj.com/articles/2394.pdf">network certainty</a>. With this method, we can get the ranking of each individual according to their network position (akin to how much power or influence over others an individual has) and determine how certain we are of that ranking by examining the consistency of indirect relationships. We can use the <code>Perc</code> R package to do this.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="analyzing-social-hierarchy-data.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Perc)</span>
<span id="cb74-2"><a href="analyzing-social-hierarchy-data.html#cb74-2" aria-hidden="true" tabindex="-1"></a>obsmat <span class="ot">&lt;-</span> <span class="fu">as.conflictmat</span>(wldf)</span>
<span id="cb74-3"><a href="analyzing-social-hierarchy-data.html#cb74-3" aria-hidden="true" tabindex="-1"></a>DominanceProbability.obs <span class="ot">&lt;-</span> <span class="fu">conductance</span>(obsmat, <span class="at">maxLength =</span> <span class="dv">2</span>)</span>
<span id="cb74-4"><a href="analyzing-social-hierarchy-data.html#cb74-4" aria-hidden="true" tabindex="-1"></a>s.rank.obs <span class="ot">&lt;-</span> <span class="fu">simRankOrder</span>(DominanceProbability.obs<span class="sc">$</span>p.hat, <span class="at">num =</span> <span class="dv">10</span>, <span class="at">kmax =</span> <span class="dv">10</span>)</span>
<span id="cb74-5"><a href="analyzing-social-hierarchy-data.html#cb74-5" aria-hidden="true" tabindex="-1"></a>dfobs <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="fu">individualDomProb</span>(DominanceProbability.obs<span class="sc">$</span>p.hat), s.rank.obs<span class="sc">$</span>BestSimulatedRankOrder)</span>
<span id="cb74-6"><a href="analyzing-social-hierarchy-data.html#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dfobs<span class="sc">$</span>ranking, dfobs<span class="sc">$</span>Mean,</span>
<span id="cb74-7"><a href="analyzing-social-hierarchy-data.html#cb74-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Rank&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Dominance Certainty&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="temporal-based-methods" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> Temporal Based Methods</h2>
<div id="glicko-ratings" class="section level3" number="2.9.1">
<h3><span class="header-section-number">2.9.1</span> Glicko Ratings</h3>
<p>There are a number of temporally based ratings methods that calculate dynamic changes in ratings over time. Two of these methods - <a href="http://glicko.net/glicko.html">ELO &amp; Glicko</a> - are pairwise-contest models where all individuals start with an initial rating. Without any other knowledge about the individuals we assume they all have the same initial ratings. Individuals gain points for each win and lose points for each loss. The magnitude of the gain/loss in points is based on the ratings difference between contestants at a particular time. Each method has a constant value that adjusts this calculation. I prefer the Glicko method because it additionally has a standard deviation of ratings giving us a measure of how certain we are that individuals differ. The Glicko also has a decay function meaning that the rating uncertainty increases if individuals haven’t competed in a while.</p>
<p>We could calculate ratings at the end of each day. Most primate studies use this approach. However, as we observe all animals all of the time, I prefer to recalculate ratings after every observation and use a smaller constant value (a higher constant value makes the ratins more volatile - they respond to changes more rapidly).</p>
<p>We can use the <code>PlayerRatings</code> package to calculate the Glicko ratings like this:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="analyzing-social-hierarchy-data.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PlayerRatings)</span>
<span id="cb75-2"><a href="analyzing-social-hierarchy-data.html#cb75-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> df1[<span class="fu">order</span>(df1<span class="sc">$</span>Timestamp),] <span class="co">#ensure in date order</span></span>
<span id="cb75-3"><a href="analyzing-social-hierarchy-data.html#cb75-3" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df1)</span>
<span id="cb75-4"><a href="analyzing-social-hierarchy-data.html#cb75-4" aria-hidden="true" tabindex="-1"></a>glick.df <span class="ot">&lt;-</span> df1[, <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">10</span>), with <span class="ot">=</span> <span class="cn">FALSE</span>] <span class="co">#need event, actor, recipient, score</span></span>
<span id="cb75-5"><a href="analyzing-social-hierarchy-data.html#cb75-5" aria-hidden="true" tabindex="-1"></a>gl <span class="ot">&lt;-</span> <span class="fu">glicko</span>(glick.df, <span class="at">history=</span>T, <span class="at">cval=</span><span class="dv">2</span>)</span>
<span id="cb75-6"><a href="analyzing-social-hierarchy-data.html#cb75-6" aria-hidden="true" tabindex="-1"></a>gl</span></code></pre></div>
<pre><code>## 
## Glicko Ratings For 12 Players Playing 1031 Games
## 
##    Player Rating Deviation Games Win Draw Loss Lag
## 1       4   2866     58.04   489 480    1    8   0
## 2       3   2367     49.09   247 134    2  111  15
## 3       7   2319     44.76   281 150    0  131  45
## 4       6   2254     41.33   255 136    2  117   1
## 5      11   2242     56.02   140  51    1   88   7
## 6       1   2030     64.35    86  19    1   66  16
## 7       5   2017     83.67    44   7    0   37  34
## 8       8   1928     55.20   141  20    0  121  24
## 9      12   1927     68.72    78  13    0   65   1
## 10      2   1849     69.54   104   8    3   93   7
## 11      9   1771     73.70    98   5    1   92  14
## 12     10   1714     85.92    99   2    1   96   0</code></pre>
<p><br></p>
<p>Of course, the choice of <code>cval</code> affects how volatile individual ratings are. When recalculating ratings after every behavioral interaction, we have found that a lower value of <code>cval</code> provides stable rankings that most strongly reflect the rankings of animals as determined by other methods.</p>
<p>How Glicko ratings change over time can be calculated using the basic plot function:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="analyzing-social-hierarchy-data.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gl,<span class="at">npl=</span><span class="dv">12</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p><br>
The above base r plot is not aesthetically pleasing. I have created a default function that allows us to take a glicko object and convert this to a more attractive plot.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="analyzing-social-hierarchy-data.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotglicko</span>(glick.df, <span class="at">cval=</span><span class="dv">2</span>, <span class="at">ylim1=</span><span class="dv">1500</span>, <span class="at">ylim2=</span><span class="dv">3000</span>, <span class="at">thetitle=</span><span class="st">&quot;Glicko Ratings over Time&quot;</span>,<span class="at">linewd=</span>.<span class="dv">5</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p><br></p>
<p>We can also plot the final glicko ratings by rank and show the deviations in ratings scores.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="analyzing-social-hierarchy-data.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gl<span class="sc">$</span>ratings, <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y=</span>Rating)) <span class="sc">+</span> </span>
<span id="cb79-2"><a href="analyzing-social-hierarchy-data.html#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb79-3"><a href="analyzing-social-hierarchy-data.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">labels=</span>gl<span class="sc">$</span>ratings<span class="sc">$</span>Player)<span class="sc">+</span></span>
<span id="cb79-4"><a href="analyzing-social-hierarchy-data.html#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>Rating<span class="sc">-</span>Deviation, <span class="at">ymax=</span>Rating<span class="sc">+</span>Deviation),</span>
<span id="cb79-5"><a href="analyzing-social-hierarchy-data.html#cb79-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">width=</span>.<span class="dv">2</span>,                    </span>
<span id="cb79-6"><a href="analyzing-social-hierarchy-data.html#cb79-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>),</span>
<span id="cb79-7"><a href="analyzing-social-hierarchy-data.html#cb79-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">size=</span>.<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb79-8"><a href="analyzing-social-hierarchy-data.html#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">2200</span>, <span class="at">color=</span><span class="st">&#39;red&#39;</span>, <span class="at">linetype=</span><span class="st">&#39;dotted&#39;</span>)<span class="sc">+</span></span>
<span id="cb79-9"><a href="analyzing-social-hierarchy-data.html#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Glicko Rating (Mean ± SD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-10"><a href="analyzing-social-hierarchy-data.html#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Animal ID&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-11"><a href="analyzing-social-hierarchy-data.html#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb79-12"><a href="analyzing-social-hierarchy-data.html#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Final Glicko Ratings&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="stability-indices" class="section level3" number="2.9.2">
<h3><span class="header-section-number">2.9.2</span> Stability Indices</h3>
<p>To examine how ‘stable’ rankings are across time, one could use the stability index suggested by <a href="http://www.eva.mpg.de/pks/staff/widdig/pdf/Neumann_et_al-2011_Assessing_dominance_hierarchie.pdf">Neumann et al 2011</a> and improved upon by <a href="https://academic.oup.com/beheco/article/24/2/511/250731/Comparative-transitive-and-temporal-orderliness-in">Mcdonald &amp; Shizuka 2013</a>. This essentially assesses how many ranking changes there have been across days between two time-points. It ranges between 0 and 1 with 1 indicating complete stability and 0 indicating complete instability in ranking. Here, I will evaluate stability across the whole period using the ELO method as the baseline for assessing ranks. There could be many modifications to this - we could use a different method for determining ratings on each day, we could use a different time-point for comparison (e.g. per hour), we could also change the constant in the ELO formula. There is also a ‘weighting’ factor in this algorithm that accounts for whether to penalize rank changes among higher ranked animals as more impactful on ‘stability’. In the example below, I’ve used the default weighting factor, though the function of this weighting could be adjusted. I may write more about this in the future. We will use the EloRating package to calculate this.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="analyzing-social-hierarchy-data.html#cb80-1" aria-hidden="true" tabindex="-1"></a>df1.st <span class="ot">&lt;-</span> df1[score<span class="sc">==</span><span class="dv">1</span>] <span class="co"># we only consider wins at the moment</span></span>
<span id="cb80-2"><a href="analyzing-social-hierarchy-data.html#cb80-2" aria-hidden="true" tabindex="-1"></a>df1.st<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.Date</span>(df1.st<span class="sc">$</span>Timestamp)) <span class="co">#ELO stability function requires a character vector of form &quot;YYYY-MM-DD&quot;</span></span>
<span id="cb80-3"><a href="analyzing-social-hierarchy-data.html#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="analyzing-social-hierarchy-data.html#cb80-4" aria-hidden="true" tabindex="-1"></a>SEQ <span class="ot">&lt;-</span> EloRating<span class="sc">::</span><span class="fu">elo.seq</span>(<span class="at">winner=</span>df1.st<span class="sc">$</span>Actor, <span class="at">loser=</span>df1.st<span class="sc">$</span>Recipient, <span class="at">Date=</span>df1.st<span class="sc">$</span>Date, <span class="at">k=</span><span class="dv">100</span>, <span class="at">progressbar=</span><span class="cn">FALSE</span>) <span class="co">#note that could change k-factor here;  k=100 default</span></span>
<span id="cb80-5"><a href="analyzing-social-hierarchy-data.html#cb80-5" aria-hidden="true" tabindex="-1"></a>SI <span class="ot">&lt;-</span> EloRating<span class="sc">::</span><span class="fu">stab_elo</span>(SEQ, <span class="at">from=</span><span class="fu">min</span>(SEQ<span class="sc">$</span>stability<span class="sc">$</span>date),<span class="at">to=</span><span class="fu">max</span>(SEQ<span class="sc">$</span>stability<span class="sc">$</span>date), <span class="at">weight=</span>T)</span>
<span id="cb80-6"><a href="analyzing-social-hierarchy-data.html#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="analyzing-social-hierarchy-data.html#cb80-7" aria-hidden="true" tabindex="-1"></a>SI</span></code></pre></div>
<pre><code>## [1] 0.9138</code></pre>
<p>Again, there are many other dynamic network based measures of individual ratings that we could use instead. Depending on the data collected and the question of interest, there may be benefits to choosing these methods. I may write a primer on these also in the future.</p>
<p><br></p>
</div>
<div id="temporal-social-dynamics" class="section level3" number="2.9.3">
<h3><span class="header-section-number">2.9.3</span> Temporal Social Dynamics</h3>
<p>Calculating indices of hierarchical organization using all data at once may not be suitable. We may, for instance, wish to see how one metric changes over time. Here, we will look at how triangle transitivity changes over time.</p>
<p>Below, we split the raw data into a new dataframe for everyday containing data from day 1 up to that day. Therefore there are 21 dataframes in total (as there are 21 days’ worth of data - although the last day of observations was 22, we did not have any observations for day 20).</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="analyzing-social-hierarchy-data.html#cb82-1" aria-hidden="true" tabindex="-1"></a>wlmat.days <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb82-2"><a href="analyzing-social-hierarchy-data.html#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Reduce</span>(rbind, <span class="fu">split</span>(df1, df1<span class="sc">$</span>day), <span class="at">accumulate=</span><span class="cn">TRUE</span>),</span>
<span id="cb82-3"><a href="analyzing-social-hierarchy-data.html#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">get_wl_matrix</span>(x[score<span class="sc">==</span><span class="dv">1</span>][, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>), <span class="at">with =</span> <span class="cn">FALSE</span>])</span>
<span id="cb82-4"><a href="analyzing-social-hierarchy-data.html#cb82-4" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb82-5"><a href="analyzing-social-hierarchy-data.html#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="analyzing-social-hierarchy-data.html#cb82-6" aria-hidden="true" tabindex="-1"></a>wlmat.days[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##      Recipient
## Actor 1 10 11 2 3 4 5 6 7 8 9
##    1  0  0  0 0 0 0 0 0 0 1 0
##    10 0  0  0 0 0 0 0 0 0 0 0
##    11 0  0  0 0 0 0 0 0 0 0 0
##    2  0  0  0 0 0 0 0 0 0 0 0
##    3  0  0  0 0 0 1 0 1 0 0 0
##    4  4  1  2 4 1 0 2 0 1 1 0
##    5  2  0  0 0 0 0 0 0 0 0 0
##    6  1  2  0 1 0 0 1 0 0 0 0
##    7  0  0  0 0 0 0 0 0 0 0 0
##    8  0  0  0 0 0 0 0 0 0 0 0
##    9  0  0  1 0 0 0 0 0 0 0 0</code></pre>
<p>The above matrix is the winner-loser sociomatrix based on only day 1 data.</p>
<p>We can then plot how triangle transitivity changes across days:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="analyzing-social-hierarchy-data.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>,<span class="dv">21</span><span class="sc">:</span><span class="dv">22</span>), <span class="fu">unlist</span>(<span class="fu">lapply</span>(wlmat.days, <span class="cf">function</span>(x) <span class="fu">ttri</span>(x)<span class="sc">$</span>ttri)), <span class="st">&quot;l&quot;</span>, </span>
<span id="cb84-2"><a href="analyzing-social-hierarchy-data.html#cb84-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Day&quot;</span>,</span>
<span id="cb84-3"><a href="analyzing-social-hierarchy-data.html#cb84-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Triangle Transitivity&quot;</span>,</span>
<span id="cb84-4"><a href="analyzing-social-hierarchy-data.html#cb84-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Change in Triangle Transitivity over Days&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p><br>
Of course, we could prefer to use a different temporal strategy. For instance, we could use a sliding window approach looking at how triangle transitivity changes for e.g. 3 days at a time. So we would plot ttri for days 1-3, then days 2-4, 3-5 etc.</p>
<p>Another extension of this approach is something we discussed in our <a href="http://curleylab.psych.columbia.edu/pdfs/Williamson_et_al_2016_AB.pdf">Animal Behaviour</a> paper. At the end of each day, we could only keep the last ‘n’ interactions between any pair of individuals. This has the advantage of not including behavioral events that occurred long before the day of interest. For example, if animal A had accrued 100 wins against B and B had never beaten A, then if that relationships changed on e.g. day 10 it could take several days to register in the ttri - because it could take a long time for B to get more than 100 wins against A to ‘flip’ that relationship. Only considering e.g. the last 3 interactions overcomes this issue.</p>
<p>To do these calculations we can use a function I wrote that we have already sourced from GitHub above.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="analyzing-social-hierarchy-data.html#cb85-1" aria-hidden="true" tabindex="-1"></a>ttri_N <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb85-2"><a href="analyzing-social-hierarchy-data.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Reduce</span>(rbind, <span class="fu">split</span>(df1, df1<span class="sc">$</span>day), <span class="at">accumulate=</span><span class="cn">TRUE</span>),</span>
<span id="cb85-3"><a href="analyzing-social-hierarchy-data.html#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">ttri_lastN</span>(x, <span class="at">N=</span><span class="dv">3</span>)</span>
<span id="cb85-4"><a href="analyzing-social-hierarchy-data.html#cb85-4" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb85-5"><a href="analyzing-social-hierarchy-data.html#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="analyzing-social-hierarchy-data.html#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>,<span class="dv">21</span><span class="sc">:</span><span class="dv">22</span>), <span class="fu">unlist</span>(ttri_N), <span class="st">&quot;l&quot;</span>, </span>
<span id="cb85-7"><a href="analyzing-social-hierarchy-data.html#cb85-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Day&quot;</span>,</span>
<span id="cb85-8"><a href="analyzing-social-hierarchy-data.html#cb85-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Triangle Transitivity&quot;</span>,</span>
<span id="cb85-9"><a href="analyzing-social-hierarchy-data.html#cb85-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Change in Triangle Transitivity </span><span class="sc">\n</span><span class="st"> using 3 most recent interactions&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p><br></p>
</div>
</div>
<div id="summary" class="section level2" number="2.10">
<h2><span class="header-section-number">2.10</span> Summary</h2>
<p>In this brief primer, I have shown you how to import the raw data, clean the data up for analysis, calculate measures of overall hierarchical nature of the group and calculate individual metrics of dominance. I’ve also shown how to look at some temporal dynamics.</p>
<p><br></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plotting-sociomatrices-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jalapic/guides/edit/master/02-hierarchy.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/jalapic/guides/blob/master/02-hierarchy.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
